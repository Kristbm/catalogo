<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <!--<meta name="viewport" content="width=device-width, initial-scale=1.0">-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Confitería Roray</title>
  <!-- Enlaces a Bootstrap CSS -->
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <!-- Enlaces a Font Awesome CSS -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
  <link href="../dist/css/adminlte.min.css">
</head>
<style>
  ::-webkit-scrollbar {
    display: none;
  }

  .product-card {
    border: none;
    border-radius: 10px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    margin-bottom: 20px;
    display: flex;
    overflow: hidden;
    transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
  }

  .product-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 6px 10px rgba(0, 0, 0, 0.2);
  }

  .product-card img {
    width: 150px;
    height: 150px;
    border-radius: 10px 0 0 10px;
    object-fit: contain;
  }

  .product-card .card-body {
    flex: 1;
    padding: 20px;
  }

  .product-card h6 {
    font-size: 1.2rem;
    margin-bottom: 10px;
  }

  .product-card .badge {
    font-size: 0.9rem;
    margin-right: 5px;
    margin-bottom: 5px;
  }

  .product-card .view-more-btn {
    font-size: 0.9rem;
    padding: 5px 10px;
    margin-top: 10px;
  }

  .price-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 10px;
  }

  .price {
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .price-value {
    font-size: 0.9rem;
      
    font-weight: bold;
  }

  #results {
    padding-top: 200px;
  }

  /* Estilos para pantalla pequeña (celular) */
  @media (max-width: 575.98px) {
    .product-card img {
      width: 155px;
    }

    .product-card .price,
    .product-card .price-bolivar,
    .product-card .quantity,
    .product-card .quantity-bulk {
      font-size: 0.8rem;
    }

    #results {
      padding-top: 250px;
    }
  }

  /* Estilos para hacer el título y el navbar estáticos */
  .fixed-top {
    position: fixed;
    top: 0;
    width: 100%;
    z-index: 1030;
  }

  .mt-5 {
    margin-top: 3rem !important;
  }
</style>

<body>
  <!-- Título y Navbar fijos -->
  <div class="container-fluid fixed-top bg-white">
    <h1 class="mt-3 mb-4 text-center">Catálogo de Productos</h1>
    <nav class="navbar navbar-expand-md navbar-light bg-light p-3">
      <div class="container justify-content-center">
        <!-- Formulario para seleccionar la categoría -->
        <select id="categoria" class="form-control select-2" name="categoria">
          <option value="">Todos</option>
          <option value="chocolate">Chocolate</option>
          <option value="galleta">Galletas</option>
          <option value="chicle">Chicles</option>
          <option value="caramelo">Caramelos</option>
          <option value="gomita">Gomitas</option>
        </select>
        <!-- Mostrar la cantidad de productos -->
        <span id="cantidad-productos"></span>
      </div>
    </nav>

    <!-- Buscador -->
    <div class="row mt-4 justify-content-center">
      <div class="col-md-6">
        <form class="form-inline">
          <input id="search" class="form-control w-100 mb-3" type="search" placeholder="Buscar" aria-label="Search">
        </form>
      </div>
    </div>

  </div>

  <!-- Modal -->
  <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Detalles del Producto</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="container-fluid">
            <div class="row">
              <div class="col-md-6">
                <img id="modal-product-image" src="" class="img-fluid mb-3" alt="Imagen del Producto"
                  style="width: 200px;height: 200px;">
              </div>
              <div class="col-md-6">
                <h5 id="modal-product-title"></h5>
                <p id="modal-product-description"></p>
                <p class="badge badge-primary">Precio Unid: <span id="modal-product-price"></span></p>
                <p class="badge badge-success">Precio al Mayor: <span id="modal-product-wholesale-price"></span></p>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-block btn-secondary" data-dismiss="modal">Cerrar</button>
          <!--<button type="button" class="btn btn-block btn-primary">Agregar al Carrito</button>-->
        </div>
      </div>
    </div>
  </div>

  <!-- Espacio para ajustar el contenido debajo de la barra fija -->
  <div class="mt-5 mb-5"></div>

  <!-- Estructura de cards para mostrar los resultados -->
  <div id="results" class="container mt-4">
    <div class="row">
      <!-- Los resultados se cargarán aquí -->
    </div>
  </div>

  <!-- Boostrap y jQuery -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script src="../dist/js/adminlte.min.js"></script>
  <script>
    $(document).ready(function () {
      $(document).keydown(function (event) {
        if (event.ctrlKey == true && (event.which == '61' || event.which == '107' || event.which == '173' || event.which == '109' || event.which == '187' || event.which == '189')) {
          event.preventDefault();
        }
      });

      $(window).bind('mousewheel DOMMouseScroll', function (event) {
        if (event.ctrlKey == true) {
          event.preventDefault();
        }
      });


      // Variable para almacenar los productos cargados en caché        
      var cachedProducts = [];

      // Función para cargar todos los productos al inicio
      function cargarProductos() {
        $.ajax({
          url: 'src_catalogo.php',
          type: 'POST',
          dataType: 'json',
          success: function (response) {
            // Ordenar los productos alfabéticamente por descripción
            response.sort((a, b) => a.descripcion.localeCompare(b.descripcion));
            // Mostrar los productos al cargar la página
            mostrarProductos(response);
            // Almacenar los productos en caché
            cachedProducts = response;
          },
          error: function (xhr, status, error) {
            console.error('Error al cargar productos:', error);
          }
        });
      }

      // Función para mostrar los productos en la página
      function mostrarProductos(productos) {
        var output = '';
        if (productos.length > 0) {
          productos.forEach(function (producto) {
            // Verificar si la descripción del producto contiene "oferta" o "promo"
            if (producto.descripcion.toLowerCase().includes('oferta') || producto.descripcion.toLowerCase().includes('promo')) {
              return; // No mostrar el producto si contiene "oferta" o "promo"
            }

            output += '<div class="col-md-4 card border-0 shadow-sm rounded-lg">';
            output += '<div class="product-card ">';
            output += '<img src="img/' + producto.codigo + '.png" class="card-img-top" alt="' + producto.descripcion + '">';
            output += '<div class="card-body">';
            output += '<h6 class="card-title h6">' + producto.descripcion + '</h6>';
            output += '<div class="price-info">';
            output += '<div class="price">';
            output += '<span class="price-label">Precio Unid:</span>';
            output += '<span class="price-value">' + producto.precio + '$</span>';
            output += '</div>';
            output += '<div class="price">';
            output += '<span class="price-label mb-1">Precio al Mayor:</span>';
            output += '<span class="price-value">' + producto.preciomayor + '$</span>';
            output += '</div>';
            output += '</div>';
            output += '<button type="button" class="btn btn-light btn-sm mt-2 view-more-btn" data-toggle="modal" data-target="#exampleModalCenter" data-product-id="' + producto.codigo + '">Ver más <i class="fas fa-info"></i></button>'; output += '</div>';
            output += '</div>';
            output += '</div>';
          });
        } else {
          output += '<div class="col-md-12">';
          output += '<p>No se encontraron resultados.</p>';
          output += '</div>';
        }

        // Mostrar los productos en el contenedor
        $('#results .row').html(output);
      }

      // Evento click para mostrar los detalles del producto en el modal
      $(document).on('click', '.view-more-btn', function () {
        var productId = $(this).data('product-id');
        $.ajax({
          url: 'src_detalle_producto.php',
          type: 'POST',
          data: { productId: productId },
          dataType: 'json',
          success: function (response) {
            // Mostrar los detalles del producto en el modal
            $('#modal-product-image').attr('src', 'img/' + response.codigo + '.png');
            $('#modal-product-title').text(response.descripcion);
            $('#modal-product-price').text(response.precio + '$');
            $('#modal-product-wholesale-price').text(response.preciomayor + '$');
            $('#exampleModalCenter').modal('show');
          },
          error: function (xhr, status, error) {
            console.error('Error al cargar detalles del producto:', error);
          }
        });
      });

      // Función para mostrar los detalles del producto en el modal
      function mostrarDetallesProducto(producto) {
        $('#modal-product-image').attr('src', 'img/' + producto.codigo + '.png');
        $('#modal-product-title').text(producto.descripcion);
        $('#modal-product-description').text(producto.descripcion);
        $('#modal-product-price').text(producto.precio + '$');
        $('#modal-product-wholesale-price').text(producto.preciomayor + '$');
      }
      // Función para cargar productos adicionales
      function cargarMasProductos() {
        // Realizar una solicitud AJAX para obtener más productos
        $.ajax({
          url: 'src_productos.php', // Ruta al archivo PHP que devuelve más productos
          type: 'POST',
          data: { offset: cachedProducts.length }, // Enviar un offset para obtener nuevos productos
          dataType: 'json',
          success: function (response) {
            // Combinar los nuevos productos con los productos en caché
            var nuevosProductos = response;
            var productosCombinados = cachedProducts.concat(nuevosProductos);
            // Mostrar los resultados actualizados
            mostrarProductos(productosCombinados);
            // Actualizar la caché con los productos combinados
            cachedProducts = productosCombinados;
          },
          error: function (xhr, status, error) {
            console.error('Error al cargar más productos:', error);
          }
        });
      }


      // Función para verificar si el usuario ha llegado al final de la página
      function verificarScroll() {
        if ($(window).scrollTop() + $(window).height() >= $(document).height() - 100) {
          // Si el usuario ha llegado al final de la página, cargar más productos
          cargarMasProductos();
        }
      }

      // Evento de desplazamiento para verificar el scroll
      $(window).scroll(function () {
        verificarScroll();
      });

      // Función para filtrar productos por categoría y término de búsqueda
      function filtrarProductos() {
        var categoria = $('#categoria').val().toLowerCase();
        var searchTerm = $('#search').val().toLowerCase();

        // Definir las categorías y sus palabras clave asociadas
        var categorias = {
          'todos': ['todos'],
          'galleta': ['galleta', 'galletas'],
          'chicle': ['chicle'],
          'caramelo': ['dulce', 'caramelo'],
          'gomita': ['gomitas', 'gomita'],
          'chocolate': ['chocolate', 'choco', 'flips choco']
        };

        // Obtener las palabras clave asociadas a la categoría seleccionada
        var palabrasClave = categorias[categoria] || [];

        // Obtener los productos de la caché
        var productosFiltrados = cachedProducts;

        // Filtrar por categoría si no es 'todos'
        if (categoria !== 'todos' && palabrasClave.length > 0) {
          productosFiltrados = productosFiltrados.filter(function (producto) {
            return palabrasClave.some(function (palabra) {
              return producto.descripcion.toLowerCase().includes(palabra);
            });
          });
        }

        // Filtrar por término de búsqueda
        if (searchTerm !== '') {
          productosFiltrados = productosFiltrados.filter(function (producto) {
            return producto.descripcion.toLowerCase().includes(searchTerm);
          });
        }

        // Mostrar los productos filtrados
        mostrarProductos(productosFiltrados);
      }

      // Evento para filtrar productos cuando cambia la categoría
      $('#categoria').change(filtrarProductos);

      // Evento para filtrar productos cuando cambia el término de búsqueda
      $('#search').on('input', filtrarProductos);

      // Deshabilitar la búsqueda al presionar Enter
      $('#search').on('keydown', function (event) {
        if (event.which === 13) {
          event.preventDefault();
        }
      });
      // Cargar todos los productos al inicio
      cargarProductos();
    });
    $("#btn-test").on("click", function () {
      $("#modal-zoom").modal("show");
    });


  </script>
</body>

</html>